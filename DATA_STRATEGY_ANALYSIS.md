# 11种PII训练数据策略分析

## 📊 现有数据集分析

### 当前训练数据情况

**数据集规模**：
- 训练集：**56,215样本**
- 验证集：7,026样本
- 测试集：7,028样本
- **总计：70,269样本**

**PII类型分布**（仅6种）：

| PII类型 | 样本数 | 占比 | 数据来源 |
|---------|--------|------|---------|
| ADDRESS | 46,869 | 40.2% | 真实新闻/社交文本 |
| ORGANIZATION | 29,545 | 25.4% | 真实新闻/社交文本 |
| PERSON_NAME | 26,831 | 23.0% | 真实新闻/社交文本 |
| PHONE_NUMBER | 5,867 | 5.0% | **合成数据** |
| EMAIL | 4,611 | 4.0% | **合成数据** |
| ID_CARD | 2,811 | 2.4% | **合成数据** |

**总实体数**：116,534个

**数据来源特征**：
- ✅ ADDRESS/ORGANIZATION/PERSON_NAME：来自**真实新闻语料**（如人民日报等）
- ✅ PHONE_NUMBER/EMAIL/ID_CARD：**规则生成** + 真实上下文

**示例**：
```
Input: "熊金勇妻子住院５天，她给孩子哺乳了５天，５天中，却苦了自己的孩子。"
Output: [{'type': 'PERSON_NAME', 'value': '熊金勇'}]

Input: "我的电话是19193085105。"
Output: [{'type': 'PHONE_NUMBER', 'value': '19193085105'}]

Input: "来自华远软件传媒有限公司，地址山东省沈阳县蓟州曾路K座 357398。"
Output: [{'type': 'ADDRESS', 'value': '山东省沈阳县蓟州曾路K座 357398'},
         {'type': 'ORGANIZATION', 'value': '华远软件传媒有限公司'}]
```

---

## ❌ 缺失的5种PII数据现状

### 调研结论

**是否有现成的开源数据集？** → ❌ **几乎没有！**

| PII类型 | 开源数据集 | 原因 |
|---------|-----------|------|
| BANK_CARD | ❌ | 高度敏感，隐私风险极高 |
| VEHICLE_PLATE | ⚠️ 图像数据集有（CCPD） | NER文本数据集极少 |
| IP_ADDRESS | ⚠️ 技术文档中有 | 独立标注数据集缺失 |
| POSTAL_CODE | ⚠️ 地址数据集中包含 | 独立标注数据集缺失 |
| UNIFIED_SOCIAL_CREDIT_CODE | ❌ | 商业敏感信息 |

**为什么没有？**
1. **隐私合规**：银行卡号、车牌号属于《个人信息保护法》保护范围
2. **数据价值**：真实数据属于商业机密或个人隐私
3. **法律风险**：公开分享可能违反隐私法规
4. **研究方向**：车牌识别主要用CV（计算机视觉）而非NER

---

## 🎯 问题3：三种策略对比（A/B/C）

您问到：
> "3. A B C 三种的区别是什么？优劣势是什么？"

让我详细对比：

---

### **方案A：现在就加入训练数据（17种PII一起训练）**

#### 策略
- **立即**扩展数据集：6种（现有）+ 5种（新增）+ 6种（Phase 1）= **17种PII**
- 一次性生成所有17种PII的训练数据
- 重新训练1个模型

#### 时间线
| 阶段 | 时间 | 任务 |
|------|------|------|
| 数据生成 | **2-3天** | 为11种新PII生成训练数据（每种1000-2000样本） |
| 数据审核 | **1天** | 质量检查、格式统一 |
| 模型训练 | **18-24小时** | 重新训练Qwen3-4B（2 epoch） |
| 验证测试 | **半天** | 验证17种PII性能 |
| **总计** | **4-5天** | 从开始到完成 |

#### 优势 ⭐⭐⭐⭐⭐
1. ✅ **一步到位**：直接达到商业化目标（17种PII）
2. ✅ **时间最快**：只需训练1次模型
3. ✅ **成本最低**：训练1次 = 18-24小时GPU时间
4. ✅ **效果最稳定**：所有PII类型在同一数据分布下训练

#### 劣势 ⚠️
1. ⚠️ **前期投入大**：需要一次性生成11种新PII数据
2. ⚠️ **风险集中**：如果数据质量有问题，全盘返工
3. ⚠️ **灵活性低**：无法根据反馈迭代调整

#### 适用场景
- ✅ 您已经明确需要17种PII
- ✅ 时间紧迫，需要快速商业化
- ✅ 有足够的数据生成能力

---

### **方案B：先训练11种，Phase 1的6种后续迭代**

#### 策略
- **第一阶段**：6种（现有）+ 5种（BANK_CARD等）= **11种PII**
- 训练模型1（Recall目标90%+）
- **第二阶段**：根据反馈，再加6种（护照、港澳通行证等）
- 训练模型2（17种PII）

#### 时间线
| 阶段 | 时间 | 任务 |
|------|------|------|
| **Phase 1** | | |
| 数据生成 | **1-2天** | 5种新PII（每种1000-2000样本） |
| 模型训练 | **18-24小时** | 训练模型1（11种PII） |
| 验证测试 | **半天** | 验证性能 |
| **小计** | **2-3天** | Phase 1完成 |
| **Phase 2** | | |
| 数据生成 | **1-2天** | 6种新PII（护照等） |
| 模型训练 | **18-24小时** | 训练模型2（17种PII） |
| 验证测试 | **半天** | 验证性能 |
| **小计** | **2-3天** | Phase 2完成 |
| **总计** | **4-6天** | 但分两个阶段 |

#### 优势 ⭐⭐⭐⭐
1. ✅ **风险分散**：分阶段验证，问题早发现
2. ✅ **灵活迭代**：Phase 1完成后可根据客户反馈调整Phase 2
3. ✅ **快速上线**：11种PII即可满足大部分场景，可先商业化
4. ✅ **资源优化**：如果11种已满足需求，无需做Phase 2

#### 劣势 ⚠️⚠️
1. ⚠️ **时间略长**：需要训练2次模型（总计36-48小时GPU时间）
2. ⚠️ **成本略高**：2次训练 vs 1次训练
3. ⚠️ **一致性问题**：两次训练可能导致模型行为差异

#### 适用场景
- ✅ 不确定Phase 1的6种PII是否必需
- ✅ 希望快速验证11种PII效果再决定下一步
- ✅ 资源允许，更注重稳健性

---

### **方案C：分批训练（先5种，验证效果后再加6种）**

#### 策略
- **第一批**：6种（现有）+ **2-3种**最重要的新PII（如BANK_CARD、VEHICLE_PLATE）
- 训练模型1，验证效果
- **第二批**：再加**2-3种**（如IP_ADDRESS、POSTAL_CODE等）
- 训练模型2
- **第三批**：最后加Phase 1的6种
- 训练模型3

#### 时间线
| 阶段 | 时间 | 任务 |
|------|------|------|
| **Batch 1** | 2-3天 | 8-9种PII |
| **Batch 2** | 2-3天 | 11种PII |
| **Batch 3** | 2-3天 | 17种PII |
| **总计** | **6-9天** | 分三个阶段 |

#### 优势 ⭐⭐⭐
1. ✅ **风险最低**：每次只增加少量PII，问题容易定位
2. ✅ **灵活性最高**：每批次都可以根据反馈调整
3. ✅ **学习曲线友好**：逐步积累经验

#### 劣势 ⚠️⚠️⚠️
1. ⚠️ **时间最长**：需要训练3次模型（总计54-72小时GPU时间）
2. ⚠️ **成本最高**：3次训练 + 3次数据准备
3. ⚠️ **效率低下**：过于谨慎，不适合商业化节奏

#### 适用场景
- ✅ 完全没有经验，担心数据质量
- ✅ 资源充足，不在乎时间成本
- ❌ **不推荐**：对于您的商业化目标来说太慢了

---

## 📊 三种方案对比表

| 维度 | 方案A<br>（17种一次性） | 方案B<br>（11种+6种分两次） | 方案C<br>（分三批） |
|------|---------------------|------------------------|----------------|
| **总时间** | ⭐⭐⭐⭐⭐<br>4-5天 | ⭐⭐⭐⭐<br>4-6天 | ⭐⭐<br>6-9天 |
| **GPU成本** | ⭐⭐⭐⭐⭐<br>18-24h | ⭐⭐⭐⭐<br>36-48h | ⭐⭐<br>54-72h |
| **风险控制** | ⭐⭐<br>一次全投 | ⭐⭐⭐⭐<br>分两阶段验证 | ⭐⭐⭐⭐⭐<br>最稳健 |
| **灵活性** | ⭐⭐<br>难以调整 | ⭐⭐⭐⭐<br>中等灵活 | ⭐⭐⭐⭐⭐<br>最灵活 |
| **商业化速度** | ⭐⭐⭐⭐⭐<br>最快上线 | ⭐⭐⭐⭐<br>11种可先上线 | ⭐⭐<br>太慢 |
| **性价比** | ⭐⭐⭐⭐⭐<br>最优 | ⭐⭐⭐⭐<br>良好 | ⭐⭐<br>低 |

---

## 💡 我的专业建议

### **推荐方案A** ⭐⭐⭐⭐⭐

**理由**：
1. **时间最快**：4-5天即可完成，符合商业化节奏
2. **成本最低**：只需训练1次（18-24小时）
3. **效果最稳定**：17种PII在同一数据分布下训练，一致性最好
4. **您的需求明确**：竞品分析显示17种PII是商业化必需的

**关键前提**：
- ✅ 您已经通过竞品分析明确了17种PII的重要性
- ✅ 我们有能力快速生成高质量的合成数据（基于规则+真实上下文）
- ✅ 现有的6种PII数据证明了"规则生成+真实上下文"策略有效

---

## 🚀 方案A的具体实施计划

### Day 1-2：数据生成（11种新PII）

#### 5种急需PII（优先级⭐⭐⭐⭐⭐）
1. **BANK_CARD** - 银行卡号
   - 格式：13-19位数字
   - 生成量：**2000样本**
   - 规则：Luhn算法校验

2. **VEHICLE_PLATE** - 车牌号
   - 格式：`[省份简称][字母][5-6位数字/字母]`
   - 生成量：**1500样本**
   - 覆盖：蓝牌（5位）+ 新能源牌（6位）

3. **IP_ADDRESS** - IP地址
   - 格式：IPv4 + IPv6
   - 生成量：**1000样本**
   - 规则：合法IP格式

4. **POSTAL_CODE** - 邮政编码
   - 格式：6位数字
   - 生成量：**1000样本**
   - 上下文：结合地址信息

5. **UNIFIED_SOCIAL_CREDIT_CODE** - 统一社会信用代码
   - 格式：18位数字/字母混合
   - 生成量：**1000样本**
   - 规则：校验位算法

#### 6种Phase 1 PII（优先级⭐⭐⭐⭐）
6. **PASSPORT** - 护照号
   - 格式：`E/G/P + 8位数字`
   - 生成量：**1500样本**

7. **HK_MACAU_PASS** - 港澳通行证
   - 格式：`C/H + 8-10位数字`
   - 生成量：**1000样本**

8. **DRIVER_LICENSE** - 驾驶证号
   - 格式：同身份证或独立编号
   - 生成量：**1000样本**

9. **SOCIAL_SECURITY_CARD** - 社保卡号
   - 格式：18位（同身份证）或独立
   - 生成量：**1000样本**

10. **MAC_ADDRESS** - MAC地址
    - 格式：`XX:XX:XX:XX:XX:XX`
    - 生成量：**800样本**

11. **IPV6_ADDRESS** - IPv6地址
    - 格式：`XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX`
    - 生成量：**800样本**

**总计**：**13,600个新样本**

### Day 3：数据审核与合并
- 质量检查（格式、上下文合理性）
- 与现有56,215样本合并
- **新数据集**：56,215 + 13,600 = **69,815样本**（17种PII）

### Day 4-5：模型训练
- 训练配置：同现有（2 epoch, LoRA r=16）
- 预计时间：**18-24小时**
- 目标性能：
  - 6种原有PII：Recall保持85%+
  - 11种新PII：Recall达到80%+（第一次训练）

### Day 6：验证与优化
- 100样本快速验证
- 如需调整，微调1 epoch（+9小时）

---

## 📋 问题2答案：数据来源

您问：
> "2. 和之前的6种一样，没有现成的数据集吗？"

**答案**：❌ **没有现成的公开数据集**

**但我们可以模仿现有6种PII的做法**：

### 现有6种PII的数据来源
- **ADDRESS/ORGANIZATION/PERSON_NAME**：真实新闻语料（自然出现）
- **PHONE_NUMBER/EMAIL/ID_CARD**：**规则生成 + 真实上下文**

### 新增11种PII的生成策略
**完全模仿现有做法**：
1. **规则生成PII值**：
   ```python
   # 银行卡号生成
   def generate_bank_card():
       # Luhn算法生成合法卡号
       return "6217002430009876543"

   # 车牌号生成
   def generate_vehicle_plate():
       provinces = ['京', '津', '沪', '渝', ...]
       return f"{random.choice(provinces)}A{random.randint(10000, 99999)}"
   ```

2. **插入真实上下文**：
   ```python
   contexts = [
       "我的银行卡号是{BANK_CARD}，请核实。",
       "车牌号{VEHICLE_PLATE}的车辆违章了。",
       "服务器IP地址为{IP_ADDRESS}，请检查。"
   ]
   ```

3. **结合新闻语料**：
   - 可以从现有的真实新闻中提取上下文
   - 用PII值替换敏感信息位置

**示例对比**：

现有数据：
```json
{
  "input": "我的电话是19193085105。",
  "output": {"entities": [{"type": "PHONE_NUMBER", "value": "19193085105"}]}
}
```

新生成数据：
```json
{
  "input": "银行卡号6217002430009876543已激活。",
  "output": {"entities": [{"type": "BANK_CARD", "value": "6217002430009876543"}]}
}
```

**质量保证**：
- ✅ 与现有数据格式完全一致
- ✅ 上下文自然（基于真实语料）
- ✅ PII值合法（符合规则校验）

---

## 🎯 最终建议

### 立即执行：**方案A（17种PII一次性训练）**

**原因**：
1. ✅ **时间最优**：4-5天完成，最快商业化
2. ✅ **成本最低**：只需1次训练（18-24小时）
3. ✅ **效果最稳定**：所有PII类型一致性最好
4. ✅ **需求明确**：竞品分析已证明17种PII是必需的
5. ✅ **技术可行**：现有6种PII数据证明"规则生成+真实上下文"有效

**下一步**：
1. 今晚：设计11种新PII的生成规则（2-3小时）
2. 明天：运行数据生成脚本（自动化，1-2天）
3. 后天：数据审核与合并（半天）
4. Day 4-5：模型训练（18-24小时）
5. Day 6：验证测试

**预期结果**：
- ✅ 17种PII覆盖
- ✅ Recall 85%+（6种原有）+ 80%+（11种新增）
- ✅ 具备商业化能力

---

**您是否同意执行方案A？如果同意，我立即开始设计11种新PII的生成规则！** 🚀
