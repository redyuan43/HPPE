# HPPE 产品需求文档 (PRD)

**版本：** 1.0
**日期：** 2025年10月14日
**产品负责人：** Sarah
**项目状态：** 启动阶段

---

## 1. 产品概述

### 1.1 产品名称
**高精度隐私引擎** (High-Precision Privacy Engine, HPPE)

### 1.2 产品愿景
为企业提供一个强大、可扩展且可审计的 PII 检测与脱敏解决方案，有效降低数据隐私风险，确保遵循全球隐私法规，为企业在下游 AI 和数据分析应用中安全使用数据赋能。

### 1.3 目标用户
- **企业数据合规团队**：需要自动化 PII 检测和脱敏
- **数据工程师**：处理包含敏感信息的数据管道
- **AI/ML 团队**：需要在训练数据中移除 PII
- **开发团队**：需要集成 PII 保护到应用中

### 1.4 核心价值主张
- **高精度检测**：F2-score > 0.90，平衡精确率和召回率
- **多语言支持**：重点支持中文和英文 PII
- **混合式架构**：结合正则表达式和 LLM 的优势
- **可配置脱敏**：支持多种脱敏策略（编辑、屏蔽、哈希、合成替换）
- **本地部署**：无需将敏感数据发送到云端

---

## 2. 业务目标

### 2.1 主要目标
1. **合规性**：满足 GDPR、CCPA 和中国个人信息保护法要求
2. **准确性**：达到或超过行业标准的 PII 检测精度
3. **性能**：支持实时和批量处理场景
4. **可扩展性**：易于添加新的 PII 类型和语言支持

### 2.2 成功指标
- **精确率 (Precision)**：> 85%
- **召回率 (Recall)**：> 92%
- **F2-Score**：> 0.90
- **处理延迟 (P50)**：< 500ms
- **吞吐量**：> 100 RPS

---

## 3. 功能需求

### 3.1 核心功能

#### F1: PII 检测
**优先级：** P0 (必须有)

**描述：** 系统能够检测文本中的多种 PII 类型

**支持的 PII 类型：**

**中文 PII：**
- 身份证号 (CHINA_ID_CARD)
- 手机号码 (CHINA_PHONE)
- 银行卡号 (CHINA_BANK_CARD)
- 护照号码 (CHINA_PASSPORT)
- 姓名 (PERSON_NAME_ZH)
- 地址 (ADDRESS_ZH)

**英文 PII：**
- 社会安全号 (US_SSN)
- 信用卡号 (CREDIT_CARD)
- 电子邮件 (EMAIL_ADDRESS)
- 电话号码 (PHONE_NUMBER)
- 姓名 (PERSON_NAME)
- 地址 (ADDRESS)

**验收标准：**
- AC1: 支持上述所有 PII 类型的检测
- AC2: 每个 PII 类型的检测精度满足目标指标
- AC3: 返回实体类型、值、位置和置信度

#### F2: 脱敏处理
**优先级：** P0 (必须有)

**描述：** 对检测到的 PII 应用可配置的脱敏策略

**支持的策略：**
- **编辑 (Redaction)**：完全删除，替换为占位符
- **屏蔽 (Masking)**：部分遮蔽（如 ***-**-1234）
- **哈希 (Hashing)**：加密哈希不可逆转换
- **合成替换 (Synthetic)**：替换为格式相同的虚假数据

**验收标准：**
- AC1: 支持所有四种脱敏策略
- AC2: 可为不同 PII 类型配置不同策略
- AC3: 保持文本的可读性和可用性

#### F3: API 接口
**优先级：** P0 (必须有)

**描述：** 提供 RESTful API 接口供外部系统调用

**端点：**
- POST /api/v1/detect - PII 检测
- POST /api/v1/anonymize - PII 检测和脱敏
- POST /api/v1/batch - 批量处理

**验收标准：**
- AC1: API 响应时间符合性能指标
- AC2: 支持同步和异步处理模式
- AC3: 提供完整的 API 文档

#### F4: 批量处理
**优先级：** P1 (应该有)

**描述：** 支持批量文档的异步处理

**验收标准：**
- AC1: 支持批量提交多个文档
- AC2: 提供任务状态查询接口
- AC3: 支持处理结果导出

### 3.2 非功能需求

#### NF1: 性能
- 单文档处理延迟 (P50) < 500ms
- 单文档处理延迟 (P99) < 2000ms
- 系统吞吐量 > 100 RPS

#### NF2: 准确性
- 整体 F2-Score > 0.90
- 高风险 PII（金融、身份）F2-Score > 0.95
- 误报率 < 15%

#### NF3: 可扩展性
- 支持水平扩展（API 服务器和 Worker）
- 支持 GPU 集群负载均衡
- 易于添加新的 PII 类型

#### NF4: 安全性
- 支持 HTTPS 传输加密
- 提供审计日志
- 敏感数据不落盘（可选配置）

#### NF5: 可维护性
- 完整的单元测试覆盖率 > 80%
- 结构化日志
- Prometheus 指标监控

---

## 4. Epic 列表

### Epic 1: 核心确定性引擎（正则表达式引擎）
**状态：** 待开发
**优先级：** P0
**详情：** [epic-1-core-regex-engine.md](./prd/epic-1-core-regex-engine.md)

**目标：** 构建基于正则表达式的结构化 PII 检测引擎

**包含故事：**
- 1.1 - 正则引擎框架搭建
- 1.2 - 中文 PII 识别器实现
- 1.3 - 全球 PII 识别器实现
- 1.4 - 识别器注册表和管理

### Epic 2: LLM 上下文引擎集成
**状态：** 计划中
**优先级：** P0
**详情：** 待创建

**目标：** 集成 Qwen3 8B 用于非结构化 PII 检测

**包含故事：**
- 2.1 - vLLM 推理服务器部署
- 2.2 - Qwen3 模型集成
- 2.3 - 零样本 PII 检测实现
- 2.4 - 提示工程和优化

### Epic 3: 多阶段精炼流水线
**状态：** 计划中
**优先级：** P0
**详情：** 待创建

**目标：** 实现歧义消除和上下文验证逻辑

**包含故事：**
- 3.1 - 歧义消除模块
- 3.2 - 实体合并逻辑
- 3.3 - 上下文验证实现
- 3.4 - 误报削减优化

### Epic 4: 脱敏与屏蔽模块
**状态：** 计划中
**优先级：** P0
**详情：** 待创建

**目标：** 实现可配置的脱敏策略

**包含故事：**
- 4.1 - 脱敏策略框架
- 4.2 - 编辑和屏蔽策略
- 4.3 - 哈希和加密策略
- 4.4 - 合成数据替换

### Epic 5: API 服务和集成
**状态：** 计划中
**优先级：** P1
**详情：** 待创建

**目标：** 构建生产就绪的 API 服务

**包含故事：**
- 5.1 - FastAPI 服务框架
- 5.2 - 同步检测端点
- 5.3 - 批量处理端点
- 5.4 - 缓存和性能优化

---

## 5. 发布计划

### Phase 1: MVP (4-6 周)
**目标：** 核心确定性引擎

**交付物：**
- Epic 1 完成
- 支持主要中文和英文结构化 PII
- 基础 API 接口
- 单元测试覆盖率 > 70%

**成功标准：**
- 结构化 PII 检测精确率 > 90%
- 基本功能可演示

### Phase 2: LLM 集成 (6-8 周)
**目标：** 混合检测能力

**交付物：**
- Epic 2 完成
- 支持非结构化 PII（姓名、地址等）
- 初步的上下文理解能力

**成功标准：**
- 整体 F2-Score > 0.85
- 支持长文本处理

### Phase 3: 精炼流水线 (4-6 周)
**目标：** 高精度检测

**交付物：**
- Epic 3 完成
- 歧义消除和验证功能
- 误报率显著降低

**成功标准：**
- F2-Score > 0.90
- 误报率 < 15%

### Phase 4: 生产就绪 (4-6 周)
**目标：** 可部署的产品

**交付物：**
- Epic 4、5 完成
- 完整的脱敏功能
- 生产级 API 服务
- 监控和日志系统

**成功标准：**
- 通过性能基准测试
- 通过安全审计
- 完整的文档

---

## 6. 风险与依赖

### 6.1 技术风险
- **R1: LLM 推理性能**
  **缓解：** 使用 vLLM 优化、4-bit 量化、缓存策略

- **R2: GPU 资源不足**
  **缓解：** 云 GPU 租用、弹性扩容方案

- **R3: 中文 PII 检测准确率**
  **缓解：** 使用 Qwen3 8B、增强中文测试数据集

### 6.2 外部依赖
- Qwen3 8B 模型可用性
- vLLM 库稳定性
- GPU 硬件资源

---

## 7. 里程碑

| 里程碑 | 目标日期 | 状态 | 交付物 |
|--------|----------|------|--------|
| M1: 项目启动 | 2025-10-14 | ✅ 完成 | 需求、架构文档 |
| M2: Phase 1 MVP | 2025-11-30 | 🔄 进行中 | Epic 1 完成 |
| M3: Phase 2 LLM 集成 | 2026-01-15 | ⏳ 计划中 | Epic 2 完成 |
| M4: Phase 3 精炼流水线 | 2026-02-28 | ⏳ 计划中 | Epic 3 完成 |
| M5: Phase 4 生产发布 | 2026-04-15 | ⏳ 计划中 | 完整产品 |

---

## 8. 参考文档

- [需求规划文档](../高精度隐私引擎开发规划.md)
- [系统架构文档](./architecture.md)
- [技术栈说明](./architecture/tech-stack.md)
- [编码标准](./architecture/coding-standards.md)

---

**文档状态：** 初稿完成
**下一步：** 创建 Epic 1 详细定义